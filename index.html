<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">

  <!-- CrÃ©Ã© par Iban -->

  <!-- Viewport iOS -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

  <!-- Web app iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Senpai Stream">

  <title>Senpai Stream</title>

  <!-- IcÃ´ne iOS -->
  <link rel="apple-touch-icon" href="icon.png">
</head>

<body>

  <div id="install" style="display:none;">
    <h2>ðŸ“² Installer Senpai Stream</h2>
    <p>
      1. Appuie sur le bouton <strong>Partager</strong> en bas de Safari<br>
      2. Choisis <strong>Ajouter Ã  lâ€™Ã©cran dâ€™accueil</strong><br>
      3. Ouvre lâ€™app depuis ton Ã©cran dâ€™accueil
    </p>

    <button id="go">
      Continuer vers Senpai Stream
    </button>
  </div>

<script>
  (async () => {
    console.log("Script lancÃ©");

    const isStandalone =
      window.navigator.standalone === true ||
      window.matchMedia("(display-mode: standalone)").matches;

    console.log("isStandalone:", isStandalone);

    // ðŸ‘‰ Si installÃ© : on scrape et on redirige
    if (isStandalone) {
      console.log("Mode standalone dÃ©tectÃ©");

      const targetUrl = "https://senpai.wiki/";
      const proxyUrl =
        "https://api.allorigins.win/raw?url=" + encodeURIComponent(targetUrl);

      console.log("Target URL:", targetUrl);
      console.log("Proxy URL:", proxyUrl);

      try {
        console.log("Fetch en cours...");
        const res = await fetch(proxyUrl);
        console.log("RÃ©ponse reÃ§ue:", res.status);

        const html = await res.text();
        console.log("HTML rÃ©cupÃ©rÃ©");

        const doc = new DOMParser().parseFromString(html, "text/html");
        const link = doc.querySelector("a.url-display");

        console.log("Lien trouvÃ©:", link);

        const url = link ? link.href : null;
        console.log("URL extraite:", url);

        if (url) {
          console.log("Redirection vers:", url);
          window.location.replace(url);
        } else {
          console.log("Aucun lien trouvÃ©");
          alert("Lien introuvable.");
        }
      } catch (e) {
        console.error("Erreur fetch:", e);
        alert("Erreur de chargement.");
      }

    } 
    // ðŸ‘‰ Sinon : afficher le tuto
    else {
      console.log("Mode navigateur normal");

      document.getElementById("install").style.display = "block";

      document.getElementById("go").onclick = () => {
        console.log("Bouton cliquÃ©");

        // URL directe si pas installÃ©
        const fallbackUrl = "https://senpai.wiki/";
        console.log("Redirection fallback vers:", fallbackUrl);

        window.location.href = fallbackUrl;
      };
    }
  })();
</script>


</body>
</html>
