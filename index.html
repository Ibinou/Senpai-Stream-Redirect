<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">

  <!-- CrÃ©Ã© par Iban -->

  <!-- Viewport iOS -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

  <!-- Web app iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Senpai Stream">

  <title>Senpai Stream</title>

  <!-- IcÃ´ne iOS -->
  <link rel="apple-touch-icon" href="icon.png">
</head>

<body>

  <div id="install" style="display:none;">
    <h2>ðŸ“² Installer Senpai Stream</h2>
    <p>
      1. Appuie sur le bouton <strong>Partager</strong> en bas de Safari<br>
      2. Choisis <strong>Ajouter Ã  lâ€™Ã©cran dâ€™accueil</strong><br>
      3. Ouvre lâ€™app depuis ton Ã©cran dâ€™accueil
    </p>

    <button id="go">
      Continuer vers Senpai Stream
    </button>
  </div>

  <script>
    (async () => {
      const isStandalone =
        window.navigator.standalone === true ||
        window.matchMedia("(display-mode: standalone)").matches;

      // ðŸ‘‰ Si installÃ© : on scrape et on redirige
      if (isStandalone) {
        const targetUrl = "https://senpai.wiki/";
        const proxyUrl =
          "https://api.allorigins.win/raw?url=" + encodeURIComponent(targetUrl);

        try {
          const res = await fetch(proxyUrl);
          const html = await res.text();

          const doc = new DOMParser().parseFromString(html, "text/html");
          const link = doc.querySelector("a.url-display");
          const url = link ? link.href : null;

          if (url) {
            window.location.replace(url);
          } else {
            alert("Lien introuvable.");
          }
        } catch (e) {
          alert("Erreur de chargement.");
          console.error(e);
        }

      } 
      // ðŸ‘‰ Sinon : afficher le tuto
      else {
        document.getElementById("install").style.display = "block";

        document.getElementById("go").onclick = () => {
          window.location.href = "https://senpai-stream.beer/";
        };
      }
    })();
  </script>

</body>
</html>
